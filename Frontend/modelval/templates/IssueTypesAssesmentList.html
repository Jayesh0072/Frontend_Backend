{% extends 'adminbase.html' %}  
{% load static %} 
{% block content %}
    {% csrf_token %}
<div class="content" style="padding-top:0px;"> 
    
  <div class="content container-fluid">
    <!-- Page Header -->
  
    <!-- End Page Header -->


    <!-- Card -->
    <div class="card mb-3 mb-lg-5">
      <!-- Header -->
      <div class="card-header">
        <div class="row justify-content-between align-items-center flex-grow-1">
          
          <!-- End Col -->

          <div class="col-auto">
            <!-- Filter -->
            <div class="row align-items-sm-center">
              <div class="col-md">
                <form>
                  <!-- Search -->
                  <!-- <div class="input-group input-group-merge input-group-flush">
                    <div class="input-group-prepend input-group-text">
                      <i class="bi-search"></i>
                    </div>
                    <input id="datatableSearch" type="search" class="form-control" placeholder="Search users" aria-label="Search users">
                  </div> -->
                  <!-- End Search -->
                
                </form>
              </div>
              <!-- End Col -->

                
            </div>
            <!-- End Filter -->
          </div>
          <!-- End Col -->
        </div>
        <!-- End Row -->
      </div>
      <!-- End Header -->

      <!-- Table -->
      <div >
        <table id="datatable" style="width:100%" class="table table-thead-bordered table-nowrap table-align-middle card-table" >
               <tr>
                <td ></td>
                 <td></td>
                 <th colspan="3" style="padding-left: 10px;"><h4 style="color: black;">Thresholds for Model Issue Type Assessments</h4></th>
                 
              </tr>
              <tr>
                <td ></td>
                <td style="background-color:grey"></td>
                 <td style="background-color:grey">
            <h5 style="color: white;">Low Severity</h5></td>
                 <td style="background-color:grey">
            <h5 style="color: white;">Moderate Severity</h5h5></td>
                 <td style="background-color:grey">
            <h5 style="color: white;">High Severity</h5></td>
                
              </tr>
              <tr>
                <th rowspan="3" style="background-color:grey;width:200px"><h4 style="color: white;">Issue Type<br>Assesment</h4></th>
                 <td style="background:green;"><h4 style="color: black;">Satisfactory<h4>
                    <input type="text" id="Satisfactory" hidden value="" />
                </td>
                 {% for i in data %}
                    {% if  i.validation_rating == 'Satisfactory' and  i.severity != 'High' and i.operator != None %}
                        <td><a href="#" id="{{i.validation_rating}}_{{i.severity}}" onclick="openModal('{{i.validation_rating}}_{{i.severity}}','1','{{i.severity}}')">{{i.operator}} {{i.value}} {% if i.risk_type == '1' %}Low {% elif i.risk_type == '2' %}Medium{% else %}High {% endif %} Risk Findings</a>
                            <input type="text" id="data" hidden value="" />
                            </td> 
                    {% elif i.validation_rating == 'Satisfactory' and  i.severity != 'High' and i.operator == None %}
                        <td><a href="#" id="{{i.validation_rating}}_{{i.severity}}" onclick="openModal('{{i.validation_rating}}_{{i.severity}}','1','{{i.severity}}')">N/A</a>
                        <input type="text" id="data" hidden value="" />
                        </td>
                    <!-- <td><a href="#" id="modal2" onclick="openModal('modal2','1','Medium')">< 3 Moderate Risk Findings</a></td>
                    <td><a href="#" id="modal3" onclick="openModal('modal3','1','High')">< 1 Moderate Risk Finding</a></td> -->
                    {% endif %}
                {% endfor %}
              </tr>
              <tr>
                 <!-- <td style="background-color:grey;width:200px"><h4 style="color: white;">Issue Type<br>Assesment</h4></td> -->
                 <td style="background-color: yellow;"><h4 style="color:black">Needs Improvement<h4></td>
                 {% for i in data %}
                    {% if  i.validation_rating == 'Needs Improvement' and  i.severity != 'High' and i.operator != None %}
                        <td><a href="#" id="Improvement_{{i.severity}}" onclick="openModal('Improvement_{{i.severity}}','2','{{i.severity}}')">{{i.operator}} {{i.value}} {% if i.risk_type == '1' %}Low {% elif i.risk_type == '2' %}Medium{% else %}High {% endif %} Risk Findings</a></td>
                    {% elif i.validation_rating == 'Needs Improvement' and  i.severity != 'High' and i.operator == None  %}
                        <td><a href="#" id="Improvement_{{i.severity}}" onclick="openModal('Improvement_{{i.severity}}','2','{{i.severity}}')">N/A</a></td>
                 <!-- <td><a href="#" id="modal5" onclick="openModal('modal5','2','Medium')">≥ 3 Moderate Risk Findings</a></td>
                 <td><a href="#" id="modal6" onclick="openModal('modal6','2','High')">≥ 1 Moderate Risk Finding</a></td> -->
                 <!-- <td></td> -->
                 {% endif %}
                {% endfor %}
              </tr>
              <tr>
                <!-- <td></td> -->
                 <td style="background-color: red;"><h4 style="color: black;">Fail</h4></td>
                 <td></td>
                 <td></td>
                 {% for i in data %}
                    {% if  i.validation_rating == 'Fail' and i.severity == 'High' and i.operator != None %}
                        
                        <!-- {% if i.operator != 'None' %} -->
                            <td><a href="#" id="{{i.validation_rating}}_{{i.severity}}" onclick="openModal('{{i.validation_rating}}_{{i.severity}}','3','{{i.severity}}')">{{i.operator}} {{i.value}} {% if i.risk_type == '1' %}Low {% elif i.risk_type == '2' %}Medium{% else %}High {% endif %} Risk Findings</a></td>
                        <!-- {% else %} -->
                            <!-- <td><a href="#" id="{{i.validation_rating}}_{{i.severity}}" onclick="openModal('{{i.validation_rating}}_{{i.severity}}','3','Medium')">N/A</a></td> -->
                        <!-- {% endif %} -->
                 {% elif  i.validation_rating == 'Fail' and i.severity == 'High' and i.operator == None  %}

                  <td><a href="#" id="{{i.validation_rating}}_{{i.severity}}" onclick="openModal('{{i.validation_rating}}_{{i.severity}}','3','{{i.severity}}')">N/A</a></td> 
                 <!-- <td><a href="#" id="modal9" onclick="openModal('modal9','3','High')">≥ 1 High Risk Finding</a></td>
                 <td></td> -->
                 {% endif %}
                 {% endfor %}
              </tr>
        </table>
        
      </div>
      <!-- End Table -->

      <!-- Footer -->
      <div class="card-footer" style="padding-left: 1070px;">
        <!-- Pagination -->
        <div class="row justify-content-center justify-content-sm-between align-items-sm-center">
          
          <!-- End Col -->

          <!--Add New-->
          <div class="col-sm-auto">
            <!-- <a class="btn btn-primary" href="{{newdept}}">
              <i class="bi-plus-lg me-1"></i> Add New

            </a> -->
            <input type="button"  class="btn btn-primary px-5 px-md-5 center" onclick="SaveValidationRatings()" value="Save" />
          </div>
          <!--End Add New-->
          <!-- End Col -->
        </div>
        <!-- End Pagination -->
      </div>
      <!-- End Footer -->
    </div>
    <!-- End Card -->

  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Issue Type Assessment</h5>
          <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close"><span class="fas fa-times fs--1"></span></button>
        </div>
        <div class="modal-body">
            <div class="col-sm-auto">
                <div class="row align-items-center gx-0">
                  <div class="col">
                    <span class="text-secondary me-2">Risk Rating:</span>
                  </div>
                  <!-- End Col -->

                  <div class="col-auto">
                    <!-- Select -->
                    <div class="tom-select-custom tom-select-custom-end">
                      <select class="js-select js-datatable-filter form-select form-select-sm form-select-borderless" data-target-column-index="0" data-target-table="datatable" autocomplete="off" id="ratings" data-hs-tom-select-options='{
                                "searchInDropdown": false,
                                "hideSearch": true,
                                "dropdownWidth": "10rem"
                              }'>
                        <option value="1">Low</option>
                        <option value="2">Medium</option>
                        <option value="3">High</option>
                        
                      </select>  
                    </div>
                    <!-- End Select -->
                  </div>
                  <!-- End Col -->
                </div>
                <!-- End Row -->
              </div>
              <!-- End Col -->

              <div class="col-sm-auto">
                <div class="row align-items-center gx-0">
                  <div class="col">
                    <span class="text-secondary me-2">Operator:</span>
                  </div>
                  <!-- End Col -->

                  <div class="col-auto">
                    <!-- Select -->
                    <div class="tom-select-custom tom-select-custom-end">
                      <select class="js-select js-datatable-filter form-select form-select-sm form-select-borderless" data-target-column-index="0" data-target-table="datatable" autocomplete="off" id="operator" data-hs-tom-select-options='{
                                "searchInDropdown": false,
                                "hideSearch": true,
                                "dropdownWidth": "10rem"
                              }'>
                        <option value="=">=</option>
                        <option value=">">></option>
                        <option value=">=">>=</option>
                        <option value="<"><</option>
                        <option value="<="><=</option>
                        
                      </select>
                    </div>
                    <!-- End Select -->
                  </div>
                  <!-- End Col -->
                </div>
                <!-- End Row -->
              </div>
              <!-- End Col -->
              
              <div class="col-sm-auto">
                <div class="row align-items-center gx-0">
                  <div class="col">
                    <span class="text-secondary me-2">Value:</span>
                  </div>
                  <!-- End Col -->

                  <div class="col-auto">
                    <!-- Select -->
                    <div class="tom-select-custom tom-select-custom-end">
                      <input type="text" id="getvalue" />
                      <input type="text" id="hidden" hidden value="" />
                      <input type="text" id="type" hidden value="" />
                      <input type="text" id="severity" hidden value="" />
                    </div>
                    <!-- End Select -->
                  </div>
                  <!-- End Col -->
                </div>
                <!-- End Row -->
              </div>
              <!-- End Col -->
              
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" type="button" onclick="createValue()">Ok</button>
          <!-- <button class="btn btn-outline-primary" type="button" data-bs-dismiss="modal">No</button> -->
        </div>
      </div>
    </div>
  </div>

{% endblock content %}

{%block script%} 

  <!-- JS Global Compulsory  -->
  <script src="{% static 'Front/dist/assets/vendor/jquery/dist/jquery.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/jquery-migrate/dist/jquery-migrate.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

  <!-- JS Implementing Plugins -->
  <script src="{% static 'Front/dist/assets/vendor/hs-navbar-vertical-aside/dist/hs-navbar-vertical-aside.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/hs-form-search/dist/hs-form-search.min.js' %}"></script>

  <script src="{% static 'Front/dist/assets/vendor/chart.js/dist/Chart.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/chartjs-chart-matrix/dist/chartjs-chart-matrix.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/daterangepicker/moment.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/daterangepicker/daterangepicker.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/tom-select/dist/js/tom-select.complete.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/clipboard/dist/clipboard.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/datatables/media/js/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/datatables.net.extensions/select/select.min.js' %}"></script>

  <!-- JS Front -->
  <script src="{% static 'Front/dist/assets/js/theme.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/js/hs.theme-appearance-charts.js' %}"></script>

  <!-- JS Plugins Init. -->
  <script> 

    // INITIALIZATION OF DATATABLES
    // =======================================================
    // HSCore.components.HSDatatables.init($('#datatable'), {
    //   select: {
    //     style: 'multi',
    //     selector: 'td:first-child input[type="checkbox"]',
    //     classMap: {
    //       checkAll: '#datatableCheckAll',
    //       counter: '#datatableCounter',
    //       counterInfo: '#datatableCounterInfo'
    //     }
    //   },
    //   language: {
    //     zeroRecords: `<div class="text-center p-4">
    //           <img class="mb-3" src="{% static 'Front/dist/assets/svg/illustrations/oc-error.svg' %}" alt="Image Description" style="width: 10rem;" data-hs-theme-appearance="default">
    //           <img class="mb-3" src="{% static 'Front/dist/assets/svg/illustrations-light/oc-error.svg' %}" alt="Image Description" style="width: 10rem;" data-hs-theme-appearance="dark">
    //         <p class="mb-0">No data to show</p>
    //         </div>`
    //   }
    // });

    // const datatable = HSCore.components.HSDatatables.getItem(0)

    // document.querySelectorAll('.js-datatable-filter').forEach(function (item) {
    //   item.addEventListener('change',function(e) {
    //     const elVal = e.target.value,
    // targetColumnIndex = e.target.getAttribute('data-target-column-index'),
    // targetTable = e.target.getAttribute('data-target-table');

    // HSCore.components.HSDatatables.getItem(targetTable).column(targetColumnIndex).search(elVal !== 'null' ? elVal : '').draw()
    //   })
    // })

    function openModal(id,type,severity){
        debugger
        $('#exampleModal').modal('toggle');
        $("#hidden").val(id)
        $('#type').val(type)
        $('#severity').val(severity)

        if (severity == 'Low'){
            $("#ratings").val("1")
            $("#ratings").prop("disabled",true)
        }
        else if (severity == 'Medium'){
            $("#ratings").val("2")   
            $("#ratings").prop("disabled",true)
        }
        else {
            $("#ratings").val("3")
            $("#ratings").prop("disabled",true)
        }
    }

    function createValue(){
        debugger;
        ratings_val = $('#ratings').val()
        operator = $('#operator').val()
        value = $('#getvalue').val()
        hiddenVal = $('#hidden').val()
        type = $('#type').val()
        severity = $('#severity').val()
        if (ratings_val == '1'){
            ratings = 'Low'
        }
        else if(ratings_val == '2'){
            ratings = 'Medium'
        }
        else{
            ratings = 'High'
        }

        $('#'+hiddenVal).text(operator+" "+value+" "+ratings+" "+"Risk Findings") 
        $('#data').val(operator+","+ratings_val+","+value+","+type+","+severity)
        data = $('#data').val()

        var str = data.split(',')
        var operator = str[0]
        var ratings = str[1]
        var value = str[2]
        var type = str[3]
        if (type == '1'){
            validation_ratings = 'Satisfactory'
        }
        else if (type == '2'){
            validation_ratings = 'Needs Improvement'
        }
        else{
            validation_ratings = 'Fail'
        }
        var severity = str[4]

        $.ajax({
            url: '/SaveValidationRatings/', 
            data:{validation_ratings:validation_ratings,severity: severity,ratings:ratings,operator:operator,value:value},
           dataType: 'json',   
            success: function (data) { 
                debugger
                // alert(data.msg)
            }
        });
        $('#exampleModal').modal('toggle');


    }

    function SaveValidationRatings() {
        debugger
        // data = $('#data').val()
        // var str = data.split(',')
        // var operator = str[0]
        // var ratings = str[1]
        // var value = str[2]
        // var type = str[3]
        // if (type == '1'){
        //     validation_ratings = 'Satisfactory'
        // }
        // else if (type == '2'){
        //     validation_ratings = 'Needs Improvement'
        // }
        // else{
        //     validation_ratings = 'Fail'
        // }
        // var severity = str[4]

        $.ajax({
            url: '/ValidationRatingsdata/', 
            data:{},
           dataType: 'json',   
            success: function (data) { 
                debugger
                alert(data.msg)
            }
        });
    }



  </script>
    {%endblock script %}

