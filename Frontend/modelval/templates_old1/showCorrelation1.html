{% extends 'rmsebase.html' %} 
{% load static %} 
{% block content %}
<style>
    .fixTableHead {
        overflow-y: auto;
        height: 550px;
      }
      .fixTableHead thead th {
        position: sticky;
        top: 0;
      }
      .fixTableHead table {
        border-collapse: collapse;        
        width: 100%;
      }
      /* .fixTableHead th,
      td {
        padding: 8px 15px;
        border: 2px solid black;
      } */
      /* .fixTableHead th {
        background: black; 
      } */
</style>
<!-- Added by Shuv Ends (for Project Details pop-up)-->
<div class="content" style="padding-top:0px;"> 
  <div class="content container-fluid">
   
    
    <!-- Card -->
    <div class="card mb-3 mb-lg-5">
      <!-- Header -->
        <div class="card-header"> 
            <div class="row form-group" style="margin-bottom: 0px;">
                <div class="col col-md-11">
                    Correlation on independent variables 
                </div>
                <div class="col-12 col-md-1" style="display: flex;justify-content: flex-end;">         
                    <div style="border:solid 0px #009bd9;border-radius: 4px;width: 24px;height:24px; margin-left:4px;text-align:center;line-height:20px;"> 
                        <a href="{{ pdfFile }}" target="_blank" ><i class="fa fa-download" style="font-size: 12px;margin-right: 5px;" title="Export to PDF"></i> </a>
                        <a href="#" onclick="shoeTune()"> <i class="bi bi-chat-right-quote"></i></a></h2>                                    
                    </div>  
               </div> 
            </div>                  
        </div>  
                               
    </div>
      <!-- End Header -->

      <!-- Table -->
      <div class="card-body card-block">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="custom-nav-profile-tab" onclick="setType('Data')" data-bs-toggle="tab" href="#custom-nav-profile" role="tab" aria-controls="custom-nav-profile"
                aria-selected="false">Data</a>
                <a class="nav-item nav-link" id="custom-nav-home-tab" onclick="setType('HeatMap')" data-bs-toggle="tab" href="#custom-nav-home" role="tab" aria-controls="custom-nav-home"
                aria-selected="true">Heat Map </a>
                
            </div>
        </nav>
        <div class="tab-content pl-3 pt-2" id="nav-tabContent">
            <div class="tab-pane fade" id="custom-nav-home" role="tabpanel" aria-labelledby="custom-nav-home-tab">
                <div style="height: 80%;overflow:auto"> 
                    <div class="row">
                        <div class="col-lg-12">                                    
                            <img id="imgGraph" style="cursor: zoom-in;height: 100%;width: 100%;" src="{{ graphpath }}"> 
                        </div>
                    </div> 
                </div> 
            </div>
            <div class="tab-pane fade show active" id="custom-nav-profile" role="tabpanel" aria-labelledby="custom-nav-profile-tab">
                <!-- <div  style="height: 80%;overflow:auto" class="table-responsive table--no-card m-b-40">
                    <table id='csvData' class="table table-borderless table-striped table-earning"> -->
                <div class="table-responsive" style="height: 400px;overflow: scroll;">
                    <table class="table table-sm fs--1 mb-0">
                        <thead>
                            <tr> 
                                <th style="border: 1px solid black;text-align: center;" class="sort align-middle" scope="col"> 
                                </th> 
                                {% for data in ColNames %}
                                <th style="border: 1px solid black;text-align: center;" class="sort align-middle" scope="col">
                                    {{data}}
                                </th> 
                                {% endfor %}
                            </tr> 
                        </thead>
                        <tbody>
                            {% for key, val in df.items  %}
                            <tr> 
                                <td style="border: 1px solid black;text-align: center;" class="align-middle time white-space " >{{ key }}</td> 
                                {% for key1, val1 in val.items  %}
                                    <td style="border: 1px solid black;text-align: center;" class="align-middle time white-space " >{{ val1 }}</td> 
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table> 
                </div>
            </div> 
        </div>
    </div>
      <!-- End Table -->
    </div>

    <!-- <div class="modal fade" id="divTune" tabindex="-1" aria-labelledby="divTune" aria-hidden="true">
      <div class="modal-dialog modal-md modal-dialog-scrollable"> 
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="scrollingLongModalLabel2">Comments </h5>
            <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close"><span class="fas fa-times fs--1"></span></button>
          </div>
          <div class="modal-body p-5 px-md-6">  
              <div class="row form-group" style="padding-bottom:0px;margin-bottom:0px;padding-top:0px;margin-top:0px;"> 
                  <div class="col col-md-2">
                    <label class=" form-control-label">Comments
                    </label>
                  </div>
              </div>
            <div class="row form-group" style="padding-bottom:0px;margin-bottom:0px;padding-top:0px;margin-top:0px;"> 
                <div class="col-12 col-md-12">
                     <textarea id="txtReportComments" rows="10" style="resize: none;width: 100%;font-size: 10pt;" class="form-control form-control-sm" ></textarea>
                </div>
            </div>
 
               
          </div>
          <div class="modal-footer">
              <div class="col-auto" style="display: flex; justify-content: flex-end;"> 
              <button type="button" class="btn btn-primary btn-sm" style="margin-right: 10px;" onclick="saveReportComment()" >Save</button>
              </div>
          </div>
        </div>
      </div>
  </div> -->

  <div class="modal fade" id="divTune" tabindex="-1" aria-labelledby="divTune" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-scrollable"> 
     <div class="modal-content">
       <div class="modal-header">
         <h5 class="modal-title" id="scrollingLongModalLabel2">Comments </h5>
         <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close"><span class="fas fa-times fs--1"></span></button>
         <div class="d-flex">
           <button class="btn btn-icon btn-primary btn-circle btn-xl" id="btnchat" onclick="toogleChat('chat')"><i class="bi bi-chat-text"></i></button>
           <button class="btn btn-icon btn-primary btn-circle btn-xl" style="display: none;" id="btncomment" onclick="toogleChat('comment')"><i class="bi bi-chat-quote"></i></button>
          
         </div>
       </div>
       <div class="modal-body p-5 px-md-6">  
           <div class="chat-content tab-content flex-1" style="flex: 1;">
               <div class="tab-pane h-100 fade active show" id="tab-thread-1" role="tabpanel" aria-labelledby="tab-thread-1">
                 <div class="card flex-1 h-100"> 
                   <div id="divChatHeader" style="display: none!important;;overflow: auto !important;" class="card-body p-3 p-sm-4 d-flex flex-column scrollbar">
                       <div class="row mb-3 position-relative">
                           <div  class="col-sm-12">
                               <div class="d-flex flex-column h-100 p-3" id="divresp" style="overflow-y: scroll;;height: 100px !important;">
                                   
                                 
                                 
                               </div>
                           </div>
                       </div>                           
                   </div>
                   <div id="divChatfooter" style="display: none;"  class="card-footer">                    
                     <div class="row mb-3 position-relative">
                       <div  class="col-sm-11">
                         <textarea id ="txtcomment" rows="2" style="width: 100%;resize: none;"></textarea>
                       </div> 
                       <div class="col-sm-1">                   
                         <div class="d-flex justify-content-end align-items-end">
                          
                           <div>
                             <button class="btn btn-icon btn-primary btn-circle btn-xl" type="button" onclick="updateResponse()">
                               <i class="bi bi-send"></i></button>
                           </div>
                         </div>
                       </div>
                     </div> 
                   </div>      
                   
                   <div id="divRespHeader" style="display: none;" class="card-body p-3 p-sm-4 d-flex flex-column scrollbar">
                     <div class="row mb-3 position-relative">
                       <div  class="col-sm-12">
                         <textarea id ="txtReportComments" onkeyup="enableSave()" rows="12"  style="width: 100%;resize: none;"></textarea>
                       </div>                        
                     </div>
                      
                                       
                     <div class="row mb-3 position-relative">
                     
                       <div class="col-sm-12">                   
                         <div class="d-flex justify-content-end align-items-end">
                          
                           <div>
                             <button class="btn btn-primary" disabled type="button" id="btnSave" onclick="saveReportComment()">Save
                               </button>
                           </div>
                         </div>
                       </div>
                     </div> 
                   </div> 
                 </div>
               </div> 
             </div>

            
       </div>
       <!-- <div class="modal-footer">
           <div class="col-auto" style="display: flex; justify-content: flex-end;">
               <button type="button" class="btn btn-sm" style="margin-right: 10px;" onclick="$('#divTune').modal('toggle')" >Cancel</button> 
           <button type="button" class="btn btn-primary btn-sm" style="margin-right: 10px;" onclick="saveReportComment()" >Save</button>
           </div>
       </div> -->
     </div>
   </div> 

</div>
     <!-- Footer -->
     <div class="card-footer">
        <div class="col-12 gy-6">
            <div class="row g-3 justify-content-end" style="margin-top: 1px;">
                <div class="col-auto">
                    <button class="btn btn-primary px-5" onclick="goNext()">Next</button>
                </div>
            </div>  
        </div>
    </div>
    <!-- End Footer -->
    <!-- End Card -->

  </div>
</div>

  {% endblock content %}
  {%block script%} 

  <!-- JS Global Compulsory  -->
  <script src="{% static 'Front/dist/assets/vendor/jquery/dist/jquery.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/jquery-migrate/dist/jquery-migrate.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>

  <!-- JS Implementing Plugins -->
  <script src="{% static 'Front/dist/assets/vendor/hs-navbar-vertical-aside/dist/hs-navbar-vertical-aside.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/hs-form-search/dist/hs-form-search.min.js' %}"></script>

  <script src="{% static 'Front/dist/assets/vendor/chart.js/dist/Chart.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/chartjs-chart-matrix/dist/chartjs-chart-matrix.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/daterangepicker/moment.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/daterangepicker/daterangepicker.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/tom-select/dist/js/tom-select.complete.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/clipboard/dist/clipboard.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/datatables/media/js/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/vendor/datatables.net.extensions/select/select.min.js' %}"></script>

  <!-- JS Front -->
  <script src="{% static 'Front/dist/assets/js/theme.min.js' %}"></script>
  <script src="{% static 'Front/dist/assets/js/hs.theme-appearance-charts.js' %}"></script>
  <script src="{% static 'js/chatroom.js' %}"></script>

  <!-- JS Plugins Init. -->
  <script> 

    // INITIALIZATION OF DATATABLES
    // =======================================================
    HSCore.components.HSDatatables.init($('#datatable'), {
      select: {
        style: 'multi',
        selector: 'td:first-child input[type="checkbox"]',
        classMap: {
          checkAll: '#datatableCheckAll',
          counter: '#datatableCounter',
          counterInfo: '#datatableCounterInfo'
        }
      },
      language: {
        zeroRecords: `<div class="text-center p-4">
              <img class="mb-3" src="{% static 'Front/dist/assets/svg/illustrations/oc-error.svg' %}" alt="Image Description" style="width: 10rem;" data-hs-theme-appearance="default">
              <img class="mb-3" src="{% static 'Front/dist/assets/svg/illustrations-light/oc-error.svg' %}" alt="Image Description" style="width: 10rem;" data-hs-theme-appearance="dark">
            <p class="mb-0">No data to show</p>
            </div>`
      }
    });

    const datatable = HSCore.components.HSDatatables.getItem(0)

    document.querySelectorAll('.js-datatable-filter').forEach(function (item) {
      item.addEventListener('change',function(e) {
        const elVal = e.target.value,
    targetColumnIndex = e.target.getAttribute('data-target-column-index'),
    targetTable = e.target.getAttribute('data-target-table');

    HSCore.components.HSDatatables.getItem(targetTable).column(targetColumnIndex).search(elVal !== 'null' ? elVal : '').draw()
      })
    })
  </script>


<script type='text/javascript'>
    var myTable;
    $(document).ready( function () { 

        connectWS('VT_Diss_{{request.session.vt_mdl}}')
        debugger
        $.ajax({ 
        url: '/ValidationCommentHistory/',
        data:{'utility':'View Correlation on independent Numeric variables','subutility': ''},
        dataType: 'json',
        success: function (data) {
        debugger
        console.log("comment",data)
        alert('Comment Fetch sucessfully.') 
        qtnArr = '';
        $.each(data.data, function(key, val) {
            console.log("key------",key,"val----------",val)
            // qtnArr +=' <div class="d-flex chat-message">';
            // qtnArr +='         <div class="d-flex mb-2 flex-1">';
            // qtnArr +='           <div class="w-100 w-xxl-75">';
            // qtnArr +='             <div class="d-flex hover-actions-trigger">';                     
            // qtnArr +='               <div class="chat-message-content received me-2">';
            // qtnArr +='                 <div class="mb-1 received-message-content border rounded-2 p-3">';
            // qtnArr +='                    <p class="mb-0">'+val.Comment+'</p>';
            // qtnArr +='                 </div>';
            // qtnArr +='     </div>         ';                  
                
            // qtnArr +='  </div>';
            // qtnArr +='   <p class="mb-0 fs--2 text-600 fw-semi-bold ">'+val.uinitials +' commented on '+val.createdt+'</p>';
            // qtnArr +=' </div>';
            // qtnArr +=' </div>';
            // qtnArr +='  </div>';
            if(val.msgcss=='R')
            {
            qtnArr +=' <div class="d-flex chat-message">';
            qtnArr +='         <div class="d-flex mb-2 flex-1">';
                qtnArr +='           <div class="w-100 w-xxl-75">';
                qtnArr +='             <div class="d-flex hover-actions-trigger">';                     
                    qtnArr +='               <div class="chat-message-content received me-2">';
                    qtnArr +='                 <div class="mb-1 received-message-content border rounded-2 p-3">';
                        qtnArr +='                    <p class="mb-0">'+val.Comment+'</p>';
                        qtnArr +='                 </div>';
                        qtnArr +='     </div>         ';                  
                            
                        qtnArr +='  </div>';
                        qtnArr +='   <p class="mb-0 fs--2 text-600 fw-semi-bold ">'+val.uinitials +' commented on '+val.createdt+'</p>';
                        qtnArr +=' </div>';
                        qtnArr +=' </div>';
                        qtnArr +='  </div>';
            }
            else if(val.msgcss=='S')
            {

            qtnArr +=' <div class="d-flex chat-message">';
                qtnArr +=' <div class="d-flex mb-2 justify-content-end flex-1">';
                qtnArr +=' <div class="w-100 w-xxl-75">';
                qtnArr +=' <div class="d-flex flex-end-center hover-actions-trigger">';
                qtnArr +=' <div class="d-sm-none hover-actions align-self-center me-2 start-0">';                 
                
                    qtnArr +='<div class="bg-white rounded-pill d-flex align-items-center border border-300 px-2 actions">';
                    // qtnArr +='<button class="btn p-2" type="button"><span class="fa-solid fa-reply text-primary"></span></button>';
                    qtnArr +='<button class="btn p-2" type="button"><span class="fa-solid fa-pen-to-square text-primary"></span></button>';
                    // qtnArr +='<button class="btn p-2" type="button"><span class="fa-solid fa-trash text-primary"></span></button>';
                    // qtnArr +='<button class="btn p-2" type="button"><span class="fa-solid fa-share text-primary"></span></button>';
                    // qtnArr +='<button class="btn p-2" type="button"><span class="fa-solid fa-face-smile text-primary"></span></button>';
                    qtnArr +='</div>';
                    qtnArr +='</div>';
                qtnArr +='   <div class="d-none d-sm-flex">';
                    qtnArr +=' <div class="hover-actions position-relative align-self-center">';
                    // qtnArr +=' <button class="btn p-2 fs--2"><span class="fa-solid fa-reply text-primary"></span></button>';
                    qtnArr +=' <button class="btn p-2 fs--2" onclick="getCommentforEdit(' + val.Response_id +')" ><span class="fa-solid fa-pen-to-square text-primary" ></span></button>';
                    // qtnArr +=' <button class="btn p-2 fs--2"><span class="fa-solid fa-share text-primary"></span></button>';
                    // qtnArr +=' <button class="btn p-2 fs--2"><span class="fa-solid fa-trash text-primary"></span></button>';
                    // qtnArr +=' <button class="btn p-2 fs--2"><span class="fa-solid fa-face-smile text-primary"></span></button>';
                    qtnArr +='  </div>';
                    qtnArr +=' </div>';
                    qtnArr +=' <div class="chat-message-content me-2">';
                    qtnArr +='  <div class="mb-1 sent-message-content light bg-primary rounded-2 p-3 text-white">';
                        qtnArr +=' <p class="mb-0">'+val.Comment+'</p>';
                        qtnArr +=' </div>';
                        qtnArr +='  </div>';
                        qtnArr +=' </div>';
                        qtnArr +=' <div class="text-end">';
                        qtnArr +=' <p class="mb-0 fs--2 text-600 fw-semi-bold">'+val.uinitials +' commented on '+val.createdt+' </p>';
                        qtnArr +=' </div>';
                        qtnArr +=' </div>';
                        qtnArr +=' </div>';
                        qtnArr +=' </div> ';
            } 
        }) 
        $('#divresp').append(qtnArr)       
        }
        });
        $('#liDataV').click(function(){
        $('#sub_sub_menu').hide();
        });
        myTable=$('#csvData').DataTable({
        sDom: 'lrtip',
        fixedColumns: {
        leftColumns: 1
        },
        "ordering": false,
        scrollY: 500, 
        scrollX: true,
        scroller: true,
        paging:false,
        info:false

        
    }); 
    
    var zoomin=0;  
        $('#imgGraph').click(function(){  
            if(zoomin==0)
            { 
                zoomin=1; 
                $('#imgGraph').css("transform", "scale(2.5)");
                $('#imgGraph').css('transform-origin','0px 0px'),
                $('#imgGraph').css({'cursor':'zoom-out'});
            }
            else if(zoomin==1)
            {
                zoomin=0; 
               $('#imgGraph').css("transform", "scale(1)");
               $('#imgGraph').css('transform-origin','0px 0px'),
                $('#imgGraph').css({'cursor':'zoom-in'});
            } 
        }); 

} );

function toogleChat(id){
        var myClass = $("#iconmsg").attr("class"); 
        if(id=='chat'){       
            $("#btncomment").show();
            $("#btnchat").hide();
            $("#divChatHeader").show();
            $("#divChatfooter").show();
            $("#divRespHeader").attr('style','display:none !important'); 
        }
        else{
            $("#btncomment").hide();
            $("#btnchat").show();
            $("#divChatHeader").attr('style','display:none !important');
            $("#divChatfooter").attr('style','display:none !important');
            $("#divRespHeader").show(); 
        }
    }


let tabSel='Data'
let str = ['Data'];
function setType(tab){
    debugger
    tabSel=tab
    if (tabSel == 'HeatMap'){
      type_comm = 'chart'
      sub_utility = 'HeatMap'
      str[0] = 'HeatMap'
    }
    else{
      type_comm='table'
      sub_utility = 'data'
    }
    

}



function updateResponse(){
        debugger
        console.log(str[0])
        $.ajax({ 
        url: '/insert_VT_Discussion_Comments/',
        data:{'utility':'View Correlation on independent Numeric variables','tableType':str[0],'comment':  $("#txtcomment").val()},
        dataType: 'json',
        success: function (data) {  
                debugger
                if(data.is_taken)
                { 
                    sendPerfMonmsg($("#txtcomment").val(),'{{ request.session.uid }}',9,5,'vt_discussion','VT_Diss_{{request.session.vt_mdl}}',JSON.parse(data.data)[0].uinitials+' commented on '+ JSON.parse(data.data)[0].createdt)   
                  
                }   
        }
        });
    }

function shoeTune(){
        
        $("#divTune").modal('toggle')
    }
function saveReportComment()
{ 
$.ajax({ 
    url: '/save_desc_comments/',
    data:{'utility':'Correlation on independent variables','comment':  $("#txtReportComments").val(),'type':type_comm,'tableType':tabSel},
    dataType: 'json',
    success: function (data) {
            if(data.is_taken)
            { 
            alert('Comment saved sucessfully.')             
            }   
    }
    });
}


function getMissingvalues(){ 
var updatedData=[]
myTable.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
var data = this.data(); // able to fetch the data.
var row = this.node();
item = {}
item ["column"] = data[0];
item ["value"] = $('#missingData_'+data[0]).val();
updatedData.push(item); 
} ); 

$.ajax({
url: '/ajax/validate_username/', 
data:{ user_name: JSON.stringify(updatedData)  },
dataType: 'json',
success: function (data) {
if (data.is_taken) {
alert("Updated Successfully.");
}
}
});
}
 
        
function saveComm(){
    $.ajax({ 
                            url: '/saveChartComments/',
                            data:{ comments: $('#txtcomment').val(),'chartType':'Heatmap','xaxisval':'','yaxisval':''}, 
                            dataType: 'json',
                            success: function (data) {
                                console.log(data)
                                    if(data.is_taken)
                                    {
                                        alert('Comments saved.')
                                    }           
                                    $("#divComment").modal('toggle')
                            }
                        }); 
}
function showComment()
    {  
        $("#divComment").dialog({   
            width: "70%",   
            modal: true,
            buttons:             /* Save: function() {
                $(this).dialog("close");
                } */ [
                {
                    text: "Save",
                    "class": 'btn btn-primary btn-sm',
                    click: function() {  
                        $.ajax({ 
                            url: '/saveChartComments/',
                            data:{ comments: $('#txtcomment').val(),'chartType':'Heatmap'}, 
                            dataType: 'json',
                            success: function (data) {
                                console.log(data)
                                    if(data.is_taken)
                                    {
                                        alert('Comments added to pdf file.')
                                    }            
                            }
                        }); 
                        $(this).dialog("close");
                    }
                },
                {
                    text: "Cancel",
                    "class": 'btn btn-primary btn-sm',
                    click: function() {
                        // Save code here
                        $(this).dialog("close");
                    }
                }
            ],  
        }); 
    }

    function goNext(){
        window.location="{% url 'dist_numevari_catvar' %}"
     }
</script>
  {%endblock script %}