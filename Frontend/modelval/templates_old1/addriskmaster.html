{% extends 'adminbase.html' %} 
{% load static %}  
{% block content %}

<form id="formusercat" class="row g-3 needs-validation" novalidate="">
    
<div class="content" style="padding-top:0px;width:50%;margin-left: 25%"> 
    <div class="card shadow-none border border-300 my-4" data-component-card="data-component-card">
      <div class="card h-50">
    <div class="col-auto" style="width:100%; background-color:#e0edff;height:38px;border-bottom:solid 1px #ddd; -webkit-border-top-left-radius: 6px;
				-webkit-border-top-right-radius: 6px;
				-moz-border-radius-topleft: 6px;
				-moz-border-radius-topright: 6px;
				border-top-left-radius: 6px;
				border-top-right-radius: 6px;">
          <h4 style="color:#3e465b; padding:10px 20px">{{actPage}}</h4>
        </div> 
        <div class="card-body p-0">
        
            <div class="p-4 code-to-copy"> 
                
                <div class="row mb-3 position-relative">

                    <label class="col-sm-4 col-form-label" for="txtutype" >Utility <span style="color: red;">*</span></label>

                    <div class="col-sm-8">

                        <select class="js-select js-datatable-filter form-select form-select-sm form-select-borderless" id="utility" data-target-column-index="0" data-target-table="datatable" autocomplete="off" data-hs-tom-select-options='{
                            "searchInDropdown": false,
                            "hideSearch": true,
                            "dropdownWidth": "10rem"
                        }'>
                            <option value="null" selected>All</option>
                            <option value="utility_1">utility_1</option>
                            <option value="utility_2">utility_2</option>
                            <option value="utility_3">utility_3</option>
                        </select> 

                    </div>
                </div>
                
                <div class="row mb-3 position-relative">

                    <label class="col-sm-4 col-form-label" for="txtutype" >Label <span style="color: red;">*</span></label>

                    <div class="col-sm-8">

                        <input class="form-control" value="{{label}}" id="txtdept" type="text" onblur="checkUsername()" maxlength="100" required=""> 

                    </div>
                </div> 

                <!-- <div class="row mb-3 position-relative">

                    
                    <label class="col-form-label col-sm-4 pt-0">Is MRM?</label>
                    <div class="col-sm-2">
                        <div class="form-check">
                        {% if is_mrm == 1 %}
                        <input  class="form-check-input" {{is_mrm_exists}}  id="rbinactive" type="radio" name="rbismrm" checked="" value="1">
                        {% else %}
                        <input class="form-check-input"  {{is_mrm_exists}}  id="rbinactive" type="radio" name="rbismrm" value="1">  
                        {% endif %}      
                        <label class="form-check-label" for="rbinactive">Yes</label>
                        </div> 
                    </div>
                    <div class="col-sm-2">

                        <div class="form-check">
                        {% if is_mrm == 0 %}
                        <input class="form-check-input" {{is_mrm_exists}} checked=""id="rbactive" type="radio" name="rbismrm" value="0">
                        {% else %}
                        <input class="form-check-input" {{is_mrm_exists}} id="rbactive" type="radio" name="rbismrm" value="0">
                        {% endif %}
                        <label class="form-check-label" for="rbactive">No</label>
                        </div>  
                    </div>
                </div>  -->
                <fieldset>
                    <div class="row mb-3">

                        <label class="col-sm-4 col-form-label" for="txtdesc">Description</label>

                        <div class="col-sm-8">

                        <textarea class="form-control" id="txtdesc" type="text" maxlength="150">{{description}} </textarea>
                        </div>
                        
                    </div>
                </fieldset> 
                

                
                
                <div class="col-12 gy-6">
                    <div class="row g-3 justify-content-end">
                        <div class="col-auto"> 
                          <input type="button" class="btn btn-phoenix-primary px-5" onclick="gotolist()"   value="Cancel"/>
                        </div>
                        <div class="col-auto">
                          {% if label %}
                          <input type="hidden" id="update_id" value="{{id}}" >
                          <input type="button"  class="btn btn-primary px-5 px-sm-5" onclick="validateform()" value="Update" /> 
                          {% else %}
                          <input type="button"  class="btn btn-primary px-5 px-sm-5" onclick="validateform()" value="Add" />
                          {% endif %} 
                        </div>
                       
                      </div>
                  </div>
            </div>
        </div>
    </div>
    
    
</div>
</form>
{% endblock content %}
{% block script %}
<script type='text/javascript' >

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
    }

    function validateform(){ 
        if($("#txtdept").val().trim().length<1){
            alert('Plese enter controll class label.');
            return false;
        }
        const csrftoken = getCookie('csrftoken');
        $.ajaxSetup({
            headers: {
                'X-CSRFToken': csrftoken
            }
        });
        $.ajax({
            url: '/addriskmaster/', 
            data:{update_id:$("#update_id").val(),label: $("#txtdept").val(),desc:$('#txtdesc').val(),utility:$('#utility').val()},
           dataType: 'json',   
           method:'POST',
            success: function (data) { 
                alert(data.msg)
            }
        });
    }

    function checkUsername(){ 
        $.ajax({
            url: '/checkValue/', 
            data:{val: $("#txtdept").val(),'tbl':'dept' },
           dataType: 'json',   
            success: function (data) { 
               if(data.cnt!='0'){
                $("#txtdept").val('')
                alert('Department already exists.')
                $("#txtdept").focus()
               }
               
            }
        });
    }

    function gotolist()
    {
        window.location='{{showriskmaster}}'
        
    }
</script>
{% endblock script %}